<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RMS Setup Tool - Hotel Revenue Management</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      opacity: 0.9;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    .nav-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 0.75rem 1.5rem;
      border: none;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      text-decoration: none;
      color: #333;
    }

    .nav-tab:hover {
      background: #667eea;
      color: white;
    }

    .nav-tab.active {
      background: #667eea;
      color: white;
    }

    /* Progress Steps */
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      position: relative;
    }

    .progress-bar::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 50px;
      right: 50px;
      height: 3px;
      background: #e1e5eb;
      z-index: 0;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
      flex: 1;
    }

    .step-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e1e5eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #666;
      margin-bottom: 0.5rem;
    }

    .progress-step.active .step-number {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .progress-step.completed .step-number {
      background: #28a745;
      color: white;
    }

    .step-title {
      font-size: 0.85rem;
      color: #666;
      text-align: center;
    }

    .progress-step.active .step-title {
      color: #667eea;
      font-weight: 600;
    }

    /* Section Card */
    .section-card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.07);
      margin-bottom: 1.5rem;
    }

    .section-card.hidden {
      display: none;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #f0f0f0;
    }

    .section-icon {
      font-size: 1.5rem;
    }

    .section-header h2 {
      font-size: 1.25rem;
      color: #333;
      margin: 0;
    }

    .section-header p {
      color: #666;
      font-size: 0.9rem;
      margin: 0.25rem 0 0 0;
    }

    /* Form Elements */
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #555;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e1e5eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group .hint {
      font-size: 0.85rem;
      color: #888;
      margin-top: 0.25rem;
    }

    /* Room Types Section */
    .room-types-list {
      margin-bottom: 1rem;
    }

    .room-type-item {
      display: grid;
      grid-template-columns: 1fr 80px 100px 40px;
      gap: 0.75rem;
      align-items: center;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .room-type-item input {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .room-type-item input:focus {
      outline: none;
      border-color: #667eea;
    }

    .add-room-type {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .add-room-type input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .total-display {
      background: #e3f2fd;
      color: #1565c0;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-weight: 500;
    }

    /* Lead Time Grid */
    .lead-time-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.75rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      .lead-time-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .lead-time-item {
      text-align: center;
      background: #f8f9fa;
      padding: 1rem 0.5rem;
      border-radius: 8px;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .lead-time-item:hover {
      border-color: #667eea;
    }

    .lead-time-item label {
      display: block;
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .lead-time-item input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
    }

    .lead-time-item .unit {
      font-size: 0.75rem;
      color: #888;
      margin-top: 0.25rem;
    }

    /* Hour Grid */
    .hour-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      .hour-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .hour-item {
      text-align: center;
      background: #f8f9fa;
      padding: 0.75rem 0.5rem;
      border-radius: 6px;
    }

    .hour-item label {
      display: block;
      font-size: 0.75rem;
      color: #666;
      margin-bottom: 0.25rem;
    }

    .hour-item input {
      width: 100%;
      padding: 0.4rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      font-size: 0.9rem;
    }

    /* Hotel Type Grid */
    .hotel-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .hotel-type-card {
      border: 2px solid #e1e5eb;
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }

    .hotel-type-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .hotel-type-card.selected {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .hotel-type-card h3 {
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .hotel-type-card p {
      font-size: 0.8rem;
      color: #666;
      margin: 0;
    }

    /* Chart Container */
    .chart-container {
      height: 150px;
      margin: 1rem 0;
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f8f9fa;
      color: #333;
      border: 2px solid #e1e5eb;
    }

    .btn-secondary:hover {
      background: #e1e5eb;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .button-row {
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      margin-top: 2rem;
    }

    .button-row-right {
      display: flex;
      gap: 1rem;
    }

    /* Subsection */
    .subsection {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }

    .subsection h3 {
      font-size: 1rem;
      color: #555;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Tip Box */
    .tip-box {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      border: 1px solid rgba(102, 126, 234, 0.2);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: #667eea;
    }

    /* Location Inputs */
    .location-inputs {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .location-inputs select {
      min-width: 200px;
      flex: 1;
    }

    /* Summary Badge */
    .summary-badge {
      display: inline-block;
      background: #e3f2fd;
      color: #1565c0;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }

    .lead-total {
      text-align: center;
      margin-top: 0.75rem;
      font-size: 0.9rem;
    }

    .lead-total.valid {
      color: #28a745;
    }

    .lead-total.invalid {
      color: #dc3545;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Hotel RMS Setup Tool</h1>
    <p>Smart Configuration Assistant for Dynamic Pricing</p>
  </div>

  <div class="container">
    <div class="nav-tabs">
      <a href="setup.html" class="nav-tab active">Setup</a>
      <a href="results.html" class="nav-tab">Results</a>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
      <div class="progress-step active" id="prog1">
        <div class="step-number">1</div>
        <div class="step-title">Room Types</div>
      </div>
      <div class="progress-step" id="prog2">
        <div class="step-number">2</div>
        <div class="step-title">Property & Demand</div>
      </div>
      <div class="progress-step" id="prog3">
        <div class="step-number">3</div>
        <div class="step-title">Time Factors</div>
      </div>
    </div>

    <!-- Section 1: Room Types (Primary - gives us inventory & base rate) -->
    <div class="section-card" id="section1">
      <div class="section-header">
        <span class="section-icon">üè†</span>
        <div>
          <h2>Room Types & Inventory</h2>
          <p>Add your room types - this determines your total inventory and base pricing</p>
        </div>
      </div>

      <div class="tip-box">
        Add all your room types with their count and base price. The lowest priced room becomes your base rate for pricing calculations.
      </div>

      <div id="roomTypesList" class="room-types-list">
        <p style="color: #888; font-style: italic;">No room types added yet</p>
      </div>

      <div class="add-room-type">
        <input type="text" id="newRoomName" placeholder="Room type name (e.g., Deluxe)">
        <input type="number" id="newRoomCount" placeholder="Count" style="width: 80px;" min="1">
        <input type="number" id="newRoomPrice" placeholder="Base Price" style="width: 100px;" min="1">
        <button type="button" class="btn btn-success" onclick="addRoomType()">Add</button>
      </div>

      <div id="totalDisplay" class="total-display" style="display: none;">
        Total: <span id="totalRooms">0</span> rooms | Base Rate: ‚Çπ<span id="baseRateDisplay">0</span>
      </div>

      <div class="form-group" style="margin-top: 1.5rem;">
        <label for="maxRateInput">Maximum Room Rate (INR)</label>
        <input type="number" id="maxRateInput" placeholder="e.g., 5000" min="1" style="max-width: 200px;">
        <div class="hint">The highest price you want to charge at peak occupancy</div>
      </div>

      <div class="button-row">
        <div></div>
        <button class="btn btn-primary" onclick="nextSection(2)">Next: Property & Demand</button>
      </div>
    </div>

    <!-- Section 2: Property & Demand Factors -->
    <div class="section-card hidden" id="section2">
      <div class="section-header">
        <span class="section-icon">üìç</span>
        <div>
          <h2>Property & Demand Configuration</h2>
          <p>Set your location and property type for customized demand patterns</p>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="stateSelect">State</label>
          <select id="stateSelect" onchange="updateCities()">
            <option value="">Select State</option>
          </select>
        </div>
        <div class="form-group">
          <label for="citySelect">City</label>
          <select id="citySelect" disabled>
            <option value="">Select City</option>
          </select>
        </div>
      </div>

      <div class="subsection">
        <h3>Select Property Type</h3>
        <div class="hotel-type-grid" id="hotelTypeGrid">
          <!-- Dynamic cards will be inserted here -->
        </div>
      </div>

      <div class="button-row">
        <button class="btn btn-secondary" onclick="prevSection(1)">Back</button>
        <button class="btn btn-primary" onclick="nextSection(3)">Next: Time Factors</button>
      </div>
    </div>

    <!-- Section 3: Time Based Factors -->
    <div class="section-card hidden" id="section3">
      <div class="section-header">
        <span class="section-icon">‚è∞</span>
        <div>
          <h2>Time Based Factors</h2>
          <p>Configure booking patterns for time-sensitive pricing</p>
        </div>
      </div>

      <div class="subsection" style="margin-top: 0; padding-top: 0; border-top: none;">
        <h3>Lead Time Distribution (7 Days)</h3>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">What percentage of bookings come at each lead time?</p>

        <div class="lead-time-grid">
          <div class="lead-time-item">
            <label>Today</label>
            <input type="number" id="lead0" value="37" min="0" max="100">
            <div class="unit">%</div>
          </div>
          <div class="lead-time-item">
            <label>Tomorrow</label>
            <input type="number" id="lead1" value="11" min="0" max="100">
            <div class="unit">%</div>
          </div>
          <div class="lead-time-item">
            <label>Day 3</label>
            <input type="number" id="lead2" value="6" min="0" max="100">
            <div class="unit">%</div>
          </div>
          <div class="lead-time-item">
            <label>Day 4</label>
            <input type="number" id="lead3" value="3" min="0" max="100">
            <div class="unit">%</div>
          </div>
          <div class="lead-time-item">
            <label>Day 5</label>
            <input type="number" id="lead4" value="5" min="0" max="100">
            <div class="unit">%</div>
          </div>
          <div class="lead-time-item">
            <label>Day 6</label>
            <input type="number" id="lead5" value="4" min="0" max="100">
            <div class="unit">%</div>
          </div>
          <div class="lead-time-item">
            <label>Day 7</label>
            <input type="number" id="lead6" value="4" min="0" max="100">
            <div class="unit">%</div>
          </div>
        </div>
        <p id="leadTimeTotal" class="lead-total valid">Total: 70% (remaining 30% is 7+ days advance)</p>

        <div class="chart-container">
          <canvas id="leadTimeChart"></canvas>
        </div>
      </div>

      <div class="subsection">
        <h3>Same-Day Booking Pattern (2-Hour Slots)</h3>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">For same-day bookings, what % come at each time window?</p>

        <div class="hour-grid">
          <div class="hour-item">
            <label>6-8 AM</label>
            <input type="number" id="hour6" value="2" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>8-10 AM</label>
            <input type="number" id="hour8" value="8" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>10-12 PM</label>
            <input type="number" id="hour10" value="15" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>12-2 PM</label>
            <input type="number" id="hour12" value="12" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>2-4 PM</label>
            <input type="number" id="hour14" value="18" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>4-6 PM</label>
            <input type="number" id="hour16" value="20" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>6-8 PM</label>
            <input type="number" id="hour18" value="15" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>8-10 PM</label>
            <input type="number" id="hour20" value="7" min="0" max="100">
          </div>
          <div class="hour-item">
            <label>10-12 AM</label>
            <input type="number" id="hour22" value="3" min="0" max="100">
          </div>
        </div>

        <div class="chart-container">
          <canvas id="hourChart"></canvas>
        </div>
      </div>

      <div class="button-row">
        <button class="btn btn-secondary" onclick="prevSection(2)">Back</button>
        <button class="btn btn-primary" onclick="generateAndGoToResults()">Generate Results</button>
      </div>
    </div>
  </div>

  <script>
    // =============================================
    // STATE & DATA
    // =============================================
    let currentSection = 1;
    let roomTypes = [];
    let leadTimeChart, hourChart;
    const totalSections = 3;

    // All 28 States and 8 Union Territories of India
    const statesAndCities = {
      // States (28)
      'Andhra Pradesh': ['Visakhapatnam', 'Vijayawada', 'Tirupati', 'Guntur', 'Nellore', 'Kurnool', 'Rajahmundry', 'Kakinada', 'Anantapur', 'Kadapa'],
      'Arunachal Pradesh': ['Itanagar', 'Tawang', 'Ziro', 'Pasighat', 'Bomdila', 'Along', 'Tezu', 'Naharlagun'],
      'Assam': ['Guwahati', 'Kaziranga', 'Tezpur', 'Jorhat', 'Silchar', 'Dibrugarh', 'Majuli', 'Manas', 'Sivasagar'],
      'Bihar': ['Patna', 'Gaya', 'Bodhgaya', 'Nalanda', 'Rajgir', 'Vaishali', 'Muzaffarpur', 'Bhagalpur'],
      'Chhattisgarh': ['Raipur', 'Bilaspur', 'Jagdalpur', 'Bhilai', 'Korba', 'Durg', 'Rajnandgaon', 'Chitrakote'],
      'Goa': ['Panaji', 'Calangute', 'Candolim', 'Baga', 'Anjuna', 'Palolem', 'Vagator', 'Margao', 'Vasco da Gama', 'Old Goa'],
      'Gujarat': ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Dwarka', 'Somnath', 'Kutch', 'Gir', 'Diu', 'Gandhinagar', 'Junagadh', 'Bhuj', 'Saputara'],
      'Haryana': ['Gurgaon', 'Faridabad', 'Chandigarh', 'Panipat', 'Ambala', 'Karnal', 'Kurukshetra', 'Rohtak', 'Hisar', 'Panchkula'],
      'Himachal Pradesh': ['Shimla', 'Manali', 'Dharamshala', 'Dalhousie', 'Kasol', 'Kullu', 'Spiti', 'McLeod Ganj', 'Bir Billing', 'Khajjiar', 'Chamba', 'Kinnaur'],
      'Jharkhand': ['Ranchi', 'Jamshedpur', 'Dhanbad', 'Bokaro', 'Deoghar', 'Hazaribagh', 'Netarhat', 'Betla'],
      'Karnataka': ['Bangalore', 'Mysore', 'Mangalore', 'Hampi', 'Coorg', 'Gokarna', 'Hubli', 'Belgaum', 'Chikmagalur', 'Kabini', 'Dandeli', 'Sakleshpur', 'Udupi', 'Sringeri', 'Kollur', 'Badami', 'Bijapur'],
      'Kerala': ['Kochi', 'Thiruvananthapuram', 'Munnar', 'Alleppey', 'Kumarakom', 'Kovalam', 'Wayanad', 'Varkala', 'Thekkady', 'Kozhikode', 'Thrissur', 'Kannur', 'Bekal'],
      'Madhya Pradesh': ['Bhopal', 'Indore', 'Khajuraho', 'Ujjain', 'Kanha', 'Bandhavgarh', 'Pench', 'Satpura', 'Panna', 'Orchha', 'Gwalior', 'Mandu', 'Maheshwar', 'Jabalpur', 'Sanchi', 'Omkareshwar', 'Pachmarhi'],
      'Maharashtra': ['Mumbai', 'Pune', 'Nagpur', 'Nashik', 'Aurangabad', 'Lonavala', 'Mahabaleshwar', 'Shirdi', 'Alibaug', 'Matheran', 'Khandala', 'Kolhapur', 'Pandharpur', 'Ajanta', 'Ellora', 'Ratnagiri', 'Ganpatipule', 'Lavasa'],
      'Manipur': ['Imphal', 'Loktak Lake', 'Moirang', 'Ukhrul', 'Churachandpur', 'Senapati', 'Keibul Lamjao'],
      'Meghalaya': ['Shillong', 'Cherrapunji', 'Mawlynnong', 'Dawki', 'Mawsynram', 'Jowai', 'Tura', 'Nongpoh'],
      'Mizoram': ['Aizawl', 'Champhai', 'Lunglei', 'Reiek', 'Vantawng Falls', 'Phawngpui'],
      'Nagaland': ['Kohima', 'Dimapur', 'Mokokchung', 'Dzukou Valley', 'Tuophema', 'Khonoma'],
      'Odisha': ['Bhubaneswar', 'Puri', 'Konark', 'Cuttack', 'Chilika', 'Gopalpur', 'Chandipur', 'Simlipal', 'Bhitarkanika'],
      'Punjab': ['Amritsar', 'Chandigarh', 'Ludhiana', 'Jalandhar', 'Patiala', 'Mohali', 'Pathankot', 'Anandpur Sahib'],
      'Rajasthan': ['Jaipur', 'Udaipur', 'Jodhpur', 'Jaisalmer', 'Pushkar', 'Mount Abu', 'Ranthambore', 'Bikaner', 'Ajmer', 'Chittorgarh', 'Bundi', 'Shekhawati', 'Alwar', 'Bharatpur', 'Sawai Madhopur'],
      'Sikkim': ['Gangtok', 'Pelling', 'Lachung', 'Lachen', 'Yuksom', 'Ravangla', 'Namchi', 'Tsomgo Lake', 'Nathula'],
      'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai', 'Ooty', 'Kodaikanal', 'Pondicherry', 'Mamallapuram', 'Rameswaram', 'Kanyakumari', 'Thanjavur', 'Kumbakonam', 'Tiruchirappalli', 'Yercaud', 'Chettinad', 'Valparai', 'Tirunelveli', 'Salem'],
      'Telangana': ['Hyderabad', 'Warangal', 'Nizamabad', 'Karimnagar', 'Ramoji Film City', 'Nagarjunasagar', 'Basara'],
      'Tripura': ['Agartala', 'Udaipur', 'Neermahal', 'Unakoti', 'Sepahijala', 'Jampui Hills'],
      'Uttar Pradesh': ['Lucknow', 'Agra', 'Varanasi', 'Mathura', 'Vrindavan', 'Allahabad', 'Ayodhya', 'Chitrakoot', 'Vindhyachal', 'Sarnath', 'Fatehpur Sikri', 'Noida', 'Ghaziabad', 'Kanpur', 'Meerut', 'Jhansi'],
      'Uttarakhand': ['Dehradun', 'Mussoorie', 'Nainital', 'Rishikesh', 'Haridwar', 'Jim Corbett', 'Kedarnath', 'Badrinath', 'Gangotri', 'Yamunotri', 'Auli', 'Chopta', 'Ranikhet', 'Almora', 'Mukteshwar', 'Binsar'],
      'West Bengal': ['Kolkata', 'Darjeeling', 'Siliguri', 'Digha', 'Sundarbans', 'Shantiniketan', 'Murshidabad', 'Kalimpong', 'Dooars', 'Mandarmani'],
      // Union Territories (8)
      'Andaman & Nicobar Islands': ['Port Blair', 'Havelock Island', 'Neil Island', 'Ross Island', 'Baratang', 'Diglipur', 'Cellular Jail'],
      'Chandigarh': ['Chandigarh', 'Rock Garden', 'Sukhna Lake'],
      'Dadra and Nagar Haveli and Daman and Diu': ['Daman', 'Diu', 'Silvassa'],
      'Delhi': ['New Delhi', 'Old Delhi', 'Dwarka', 'Nehru Place', 'Connaught Place'],
      'Jammu & Kashmir': ['Srinagar', 'Gulmarg', 'Pahalgam', 'Jammu', 'Patnitop', 'Vaishno Devi', 'Sonamarg', 'Doodhpathri'],
      'Ladakh': ['Leh', 'Nubra Valley', 'Pangong Lake', 'Kargil', 'Zanskar', 'Tso Moriri', 'Hemis'],
      'Lakshadweep': ['Kavaratti', 'Agatti', 'Bangaram', 'Minicoy', 'Kalpeni'],
      'Puducherry': ['Pondicherry', 'Auroville', 'Karaikal', 'Mahe', 'Yanam']
    };

    // Hotel Types
    const hotelTypes = [
      { id: 'business', icon: 'üè¢', name: 'Business Hotel', description: 'Corporate travelers, MICE', pattern: 'metro_business' },
      { id: 'leisure', icon: 'üèñÔ∏è', name: 'Leisure/Resort', description: 'Families, weekend travelers', pattern: 'leisure' },
      { id: 'hillstation', icon: '‚õ∞Ô∏è', name: 'Hill Station', description: 'Mountain resorts', pattern: 'hill_station' },
      { id: 'beach', icon: 'üèùÔ∏è', name: 'Beach Resort', description: 'Coastal properties', pattern: 'beach' },
      { id: 'pilgrimage', icon: 'üïâÔ∏è', name: 'Pilgrimage', description: 'Temple towns', pattern: 'pilgrimage' },
      { id: 'wildlife', icon: 'üêÖ', name: 'Wildlife Lodge', description: 'Safari, national parks', pattern: 'wildlife' },
      { id: 'heritage', icon: 'üèõÔ∏è', name: 'Heritage/Boutique', description: 'Palaces, havelis', pattern: 'heritage' },
      { id: 'budget', icon: 'üí∞', name: 'Budget/Economy', description: 'Value travelers', pattern: 'budget' }
    ];

    let selectedHotelType = null;

    // =============================================
    // INITIALIZATION
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
      // Load states
      const stateSelect = document.getElementById('stateSelect');
      Object.keys(statesAndCities).sort().forEach(state => {
        const option = document.createElement('option');
        option.value = state;
        option.textContent = state;
        stateSelect.appendChild(option);
      });

      // Load hotel types
      const hotelTypeGrid = document.getElementById('hotelTypeGrid');
      hotelTypes.forEach(type => {
        const card = document.createElement('div');
        card.className = 'hotel-type-card';
        card.dataset.type = type.id;
        card.innerHTML = `<h3>${type.icon} ${type.name}</h3><p>${type.description}</p>`;
        card.onclick = () => selectHotelType(type.id);
        hotelTypeGrid.appendChild(card);
      });

      // Initialize charts
      initCharts();

      // Add event listeners for lead time inputs
      document.querySelectorAll('.lead-time-item input').forEach(input => {
        input.addEventListener('input', () => {
          updateLeadTimeTotal();
          updateCharts();
        });
      });

      document.querySelectorAll('.hour-item input').forEach(input => {
        input.addEventListener('input', updateCharts);
      });

      // Load saved data if exists
      loadSavedData();

      // Render room types
      renderRoomTypes();
    });

    // =============================================
    // NAVIGATION
    // =============================================
    function nextSection(num) {
      // Validation for section 1 (Room Types)
      if (currentSection === 1 && roomTypes.length === 0) {
        alert('Please add at least one room type before proceeding.');
        return;
      }
      saveCurrentData();
      goToSection(num);
    }

    function prevSection(num) {
      saveCurrentData();
      goToSection(num);
    }

    function goToSection(num) {
      // Hide current section
      document.getElementById(`section${currentSection}`).classList.add('hidden');
      // Show new section
      document.getElementById(`section${num}`).classList.remove('hidden');

      // Update progress bar
      for (let i = 1; i <= totalSections; i++) {
        const prog = document.getElementById(`prog${i}`);
        if (prog) {
          prog.classList.remove('active', 'completed');
          if (i < num) {
            prog.classList.add('completed');
          } else if (i === num) {
            prog.classList.add('active');
          }
        }
      }

      currentSection = num;
      window.scrollTo(0, 0);
    }

    // =============================================
    // SECTION 1: Location & Hotel Type
    // =============================================
    function updateCities() {
      const state = document.getElementById('stateSelect').value;
      const citySelect = document.getElementById('citySelect');
      citySelect.innerHTML = '<option value="">Select City</option>';
      if (state && statesAndCities[state]) {
        statesAndCities[state].forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
        citySelect.disabled = false;
      } else {
        citySelect.disabled = true;
      }
    }

    function selectHotelType(typeId) {
      selectedHotelType = typeId;
      document.querySelectorAll('.hotel-type-card').forEach(card => card.classList.remove('selected'));
      document.querySelector(`[data-type="${typeId}"]`).classList.add('selected');
    }

    // =============================================
    // SECTION 3: Room Types
    // =============================================
    function addRoomType() {
      const name = document.getElementById('newRoomName').value.trim();
      const count = parseInt(document.getElementById('newRoomCount').value);
      const price = parseFloat(document.getElementById('newRoomPrice').value);

      if (!name || !count || !price) {
        alert('Please fill all fields');
        return;
      }

      roomTypes.push({ name, count, basePrice: price });
      renderRoomTypes();

      // Clear inputs
      document.getElementById('newRoomName').value = '';
      document.getElementById('newRoomCount').value = '';
      document.getElementById('newRoomPrice').value = '';
      document.getElementById('newRoomName').focus();
    }

    function removeRoomType(index) {
      roomTypes.splice(index, 1);
      renderRoomTypes();
    }

    function renderRoomTypes() {
      const list = document.getElementById('roomTypesList');
      const totalDisplay = document.getElementById('totalDisplay');

      if (roomTypes.length === 0) {
        list.innerHTML = '<p style="color: #888; font-style: italic;">No room types added yet</p>';
        totalDisplay.style.display = 'none';
        return;
      }

      list.innerHTML = roomTypes.map((rt, index) => `
        <div class="room-type-item">
          <input type="text" value="${rt.name}" onchange="updateRoomType(${index}, 'name', this.value)">
          <input type="number" value="${rt.count}" min="1" onchange="updateRoomType(${index}, 'count', this.value)">
          <input type="number" value="${rt.basePrice}" min="1" onchange="updateRoomType(${index}, 'basePrice', this.value)">
          <button type="button" class="btn btn-danger" onclick="removeRoomType(${index})">x</button>
        </div>
      `).join('');

      // Calculate totals
      const total = roomTypes.reduce((sum, rt) => sum + rt.count, 0);
      const prices = roomTypes.map(rt => rt.basePrice);
      const baseRate = Math.min(...prices);
      const maxRate = Math.max(...prices);

      document.getElementById('totalRooms').textContent = total;
      document.getElementById('baseRateDisplay').textContent = baseRate.toLocaleString('en-IN');
      document.getElementById('maxRateDisplay').textContent = maxRate.toLocaleString('en-IN');
      totalDisplay.style.display = 'block';
    }

    function updateRoomType(index, field, value) {
      if (field === 'count' || field === 'basePrice') {
        roomTypes[index][field] = parseFloat(value);
      } else {
        roomTypes[index][field] = value;
      }
      renderRoomTypes();
    }

    // =============================================
    // SECTION 4: Time Factors
    // =============================================
    function initCharts() {
      const leadCtx = document.getElementById('leadTimeChart').getContext('2d');
      leadTimeChart = new Chart(leadCtx, {
        type: 'bar',
        data: {
          labels: ['Today', 'Tomorrow', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
          datasets: [{
            label: '% of Bookings',
            data: [37, 11, 6, 3, 5, 4, 4],
            backgroundColor: 'rgba(102, 126, 234, 0.7)',
            borderColor: 'rgba(102, 126, 234, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 50 } }
        }
      });

      const hourCtx = document.getElementById('hourChart').getContext('2d');
      hourChart = new Chart(hourCtx, {
        type: 'line',
        data: {
          labels: ['6-8', '8-10', '10-12', '12-2', '2-4', '4-6', '6-8', '8-10', '10-12'],
          datasets: [{
            label: '% of Same-Day',
            data: [2, 8, 15, 12, 18, 20, 15, 7, 3],
            borderColor: 'rgba(118, 75, 162, 1)',
            backgroundColor: 'rgba(118, 75, 162, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 30 } }
        }
      });
    }

    function updateLeadTimeTotal() {
      const total = parseInt(document.getElementById('lead0').value || 0) +
                    parseInt(document.getElementById('lead1').value || 0) +
                    parseInt(document.getElementById('lead2').value || 0) +
                    parseInt(document.getElementById('lead3').value || 0) +
                    parseInt(document.getElementById('lead4').value || 0) +
                    parseInt(document.getElementById('lead5').value || 0) +
                    parseInt(document.getElementById('lead6').value || 0);

      const remaining = 100 - total;
      const totalEl = document.getElementById('leadTimeTotal');
      totalEl.textContent = `Total: ${total}% (remaining ${remaining}% is 7+ days advance)`;
      totalEl.className = 'lead-total ' + (total <= 100 ? 'valid' : 'invalid');
    }

    function updateCharts() {
      if (leadTimeChart) {
        leadTimeChart.data.datasets[0].data = [
          parseInt(document.getElementById('lead0').value) || 0,
          parseInt(document.getElementById('lead1').value) || 0,
          parseInt(document.getElementById('lead2').value) || 0,
          parseInt(document.getElementById('lead3').value) || 0,
          parseInt(document.getElementById('lead4').value) || 0,
          parseInt(document.getElementById('lead5').value) || 0,
          parseInt(document.getElementById('lead6').value) || 0
        ];
        leadTimeChart.update();
      }

      if (hourChart) {
        hourChart.data.datasets[0].data = [
          parseInt(document.getElementById('hour6').value) || 0,
          parseInt(document.getElementById('hour8').value) || 0,
          parseInt(document.getElementById('hour10').value) || 0,
          parseInt(document.getElementById('hour12').value) || 0,
          parseInt(document.getElementById('hour14').value) || 0,
          parseInt(document.getElementById('hour16').value) || 0,
          parseInt(document.getElementById('hour18').value) || 0,
          parseInt(document.getElementById('hour20').value) || 0,
          parseInt(document.getElementById('hour22').value) || 0
        ];
        hourChart.update();
      }
    }

    // =============================================
    // DATA PERSISTENCE
    // =============================================
    function saveCurrentData() {
      // Calculate derived values from room types
      const totalInventory = roomTypes.reduce((sum, rt) => sum + rt.count, 0);
      const prices = roomTypes.length > 0 ? roomTypes.map(rt => rt.basePrice) : [0];
      const baseRate = Math.min(...prices);
      const maxRateInput = parseInt(document.getElementById('maxRateInput').value) || 0;
      // Use user-specified max rate, or default to 1.5x base rate
      const maxRate = maxRateInput > baseRate ? maxRateInput : Math.round(baseRate * 1.5);

      const data = {
        // Section 1: Room Types (primary data source)
        roomTypes: roomTypes,
        // Derived from room types
        inventory: totalInventory,
        baseRate: baseRate,
        maxRate: maxRate,
        maxRateInput: maxRateInput,
        // Section 2: Property & Demand
        state: document.getElementById('stateSelect').value,
        city: document.getElementById('citySelect').value,
        hotelType: selectedHotelType,
        // Section 3: Time Factors
        leadTime: {
          lead0: document.getElementById('lead0').value,
          lead1: document.getElementById('lead1').value,
          lead2: document.getElementById('lead2').value,
          lead3: document.getElementById('lead3').value,
          lead4: document.getElementById('lead4').value,
          lead5: document.getElementById('lead5').value,
          lead6: document.getElementById('lead6').value
        },
        hourly: {
          hour6: document.getElementById('hour6').value,
          hour8: document.getElementById('hour8').value,
          hour10: document.getElementById('hour10').value,
          hour12: document.getElementById('hour12').value,
          hour14: document.getElementById('hour14').value,
          hour16: document.getElementById('hour16').value,
          hour18: document.getElementById('hour18').value,
          hour20: document.getElementById('hour20').value,
          hour22: document.getElementById('hour22').value
        }
      };
      localStorage.setItem('rmsSetupData', JSON.stringify(data));
    }

    function loadSavedData() {
      const saved = localStorage.getItem('rmsSetupData');
      if (!saved) return;

      try {
        const data = JSON.parse(saved);

        // Section 1: Room Types
        if (data.roomTypes) {
          roomTypes = data.roomTypes;
        }
        if (data.maxRateInput) {
          document.getElementById('maxRateInput').value = data.maxRateInput;
        }

        // Section 2: Property & Demand
        if (data.state) {
          document.getElementById('stateSelect').value = data.state;
          updateCities();
          if (data.city) {
            document.getElementById('citySelect').value = data.city;
          }
        }
        if (data.hotelType) {
          selectHotelType(data.hotelType);
        }

        // Section 3: Time Factors
        if (data.leadTime) {
          Object.keys(data.leadTime).forEach(key => {
            const el = document.getElementById(key);
            if (el) el.value = data.leadTime[key];
          });
        }
        if (data.hourly) {
          Object.keys(data.hourly).forEach(key => {
            const el = document.getElementById(key);
            if (el) el.value = data.hourly[key];
          });
        }

        // Update UI
        updateLeadTimeTotal();
        setTimeout(updateCharts, 100);
      } catch (e) {
        console.error('Error loading saved data', e);
      }
    }

    // =============================================
    // GENERATE & GO TO RESULTS
    // =============================================
    function generateAndGoToResults() {
      saveCurrentData();

      // Basic validation - room types are required
      if (roomTypes.length === 0) {
        alert('Please add at least one room type before generating results.');
        goToSection(1);
        return;
      }

      // Navigate to results page
      window.location.href = 'results.html';
    }
  </script>
</body>
</html>
