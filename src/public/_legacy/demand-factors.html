<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demand Factors - RMS Setup Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      opacity: 0.9;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .nav-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 0.75rem 1.5rem;
      border: none;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      text-decoration: none;
      color: #333;
    }

    .nav-tab:hover {
      background: #667eea;
      color: white;
    }

    .nav-tab.active {
      background: #667eea;
      color: white;
    }

    .nav-tab.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Step Indicator */
    .step-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .step-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #e1e5eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #666;
    }

    .step.active .step-circle {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .step.completed .step-circle {
      background: #28a745;
      color: white;
    }

    .step-label {
      font-size: 0.9rem;
      color: #666;
    }

    .step.active .step-label {
      color: #667eea;
      font-weight: 600;
    }

    .step-line {
      width: 80px;
      height: 2px;
      background: #e1e5eb;
      margin: 0 1rem;
    }

    .step-line.completed {
      background: #28a745;
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.07);
      margin-bottom: 1.5rem;
    }

    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: #333;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-icon {
      font-size: 1.5rem;
    }

    /* Location Input */
    .location-section {
      text-align: center;
      padding: 2rem;
    }

    .location-section h2 {
      justify-content: center;
      margin-bottom: 0.5rem;
    }

    .location-section p {
      color: #666;
      margin-bottom: 1.5rem;
    }

    .location-inputs {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .location-inputs select,
    .location-inputs input {
      padding: 0.75rem 1rem;
      border: 2px solid #e1e5eb;
      border-radius: 8px;
      font-size: 1rem;
      min-width: 200px;
    }

    .location-inputs select:focus,
    .location-inputs input:focus {
      outline: none;
      border-color: #667eea;
    }

    /* Hotel Type Selector */
    .hotel-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .hotel-type-card {
      border: 2px solid #e1e5eb;
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }

    .hotel-type-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .hotel-type-card.selected {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .hotel-type-card h3 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .hotel-type-card p {
      font-size: 0.85rem;
      color: #666;
      margin: 0;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #f8f9fa;
      color: #333;
      border: 2px solid #e1e5eb;
    }

    /* Loading */
    .loading {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 1rem;
      color: #667eea;
    }

    .loading.show {
      display: flex;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid #e1e5eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Results Page */
    .hidden {
      display: none;
    }

    .results-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .results-header h2 {
      margin: 0;
      font-size: 1.2rem;
      color: white;
    }

    .location-badge {
      background: rgba(255,255,255,0.2);
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
    }

    /* Factor Sections - NEW LAYOUT */
    .factor-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .factor-grid-full {
      grid-column: 1 / -1;
    }

    @media (max-width: 900px) {
      .factor-grid {
        grid-template-columns: 1fr;
      }
    }

    .factor-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .factor-card-large {
      grid-column: 1 / -1;
    }

    .factor-header {
      background: #f8f9fa;
      padding: 0.75rem 1rem;
      font-weight: 600;
      color: #333;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .factor-header-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .count-badge {
      background: #667eea;
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .factor-content {
      padding: 1rem;
    }

    /* Weekday Table */
    .weekday-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .weekday-table th,
    .weekday-table td {
      padding: 0.5rem;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }

    .weekday-table th {
      font-weight: 600;
      color: #666;
    }

    .demand-peak {
      color: #d32f2f;
      font-weight: 600;
    }

    .demand-high {
      color: #e65100;
      font-weight: 600;
    }

    .demand-normal {
      color: #333;
    }

    .demand-low {
      color: #2e7d32;
      font-weight: 600;
    }

    .score-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      min-width: 35px;
      text-align: center;
    }

    .score-badge.peak {
      background: #ffcdd2;
      color: #c62828;
    }

    .score-badge.high {
      background: #fff3e0;
      color: #e65100;
    }

    .score-badge.normal {
      background: #f5f5f5;
      color: #666;
    }

    .score-badge.low {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .score-badge.very-low {
      background: #e0f2f1;
      color: #00695c;
    }

    /* Month Grid */
    .month-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
    }

    .month-item {
      text-align: center;
      padding: 0.6rem 0.5rem;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: help;
      transition: transform 0.2s;
    }

    .month-item:hover {
      transform: scale(1.05);
    }

    .month-item.peak {
      background: #ffcdd2;
      color: #c62828;
      font-weight: 600;
    }

    .month-item.high {
      background: #fff3e0;
      color: #e65100;
      font-weight: 600;
    }

    .month-item.normal {
      background: #f5f5f5;
      color: #666;
    }

    .month-item.low {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .month-item.very-low {
      background: #e0f2f1;
      color: #00695c;
    }

    .month-label {
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .month-score {
      font-size: 0.7rem;
      opacity: 0.9;
    }

    /* Special Dates & Long Weekends - ENHANCED */
    .special-dates-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 768px) {
      .special-dates-container {
        grid-template-columns: 1fr;
      }
    }

    .dates-column {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    .dates-column h3 {
      font-size: 0.95rem;
      margin-bottom: 0.75rem;
      color: #555;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: sticky;
      top: 0;
      background: white;
      padding: 0.5rem 0;
      z-index: 1;
    }

    .date-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      border-bottom: 1px solid #f0f0f0;
      font-size: 0.85rem;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      transition: all 0.2s;
    }

    .date-item:hover {
      background: #fafbfc;
    }

    .date-item:last-child {
      border-bottom: none;
    }

    .date-item.long-weekend {
      background: linear-gradient(135deg, #fff8e1 0%, #fff3e0 100%);
      border: 1px solid #ffe082;
      box-shadow: 0 2px 4px rgba(255, 152, 0, 0.1);
    }

    .date-item.long-weekend:hover {
      box-shadow: 0 4px 8px rgba(255, 152, 0, 0.2);
      transform: translateY(-1px);
    }

    .date-info {
      flex: 1;
    }

    .date-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 0.2rem;
    }

    .date-name .weekend-badge {
      display: inline-block;
      background: #ff9800;
      color: white;
      font-size: 0.65rem;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      margin-left: 0.4rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .date-range {
      font-size: 0.75rem;
      color: #888;
    }

    .date-multiplier {
      text-align: right;
      margin-left: 1rem;
    }

    .date-strategy {
      font-size: 0.7rem;
      color: #666;
      margin-top: 0.25rem;
      font-style: italic;
    }

    /* Key Insight */
    .key-insight {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 1rem 1.25rem;
      border-radius: 0 8px 8px 0;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .key-insight.warning {
      background: #fff8e1;
      border-left-color: #ff9800;
    }

    .key-insight.info {
      background: #e3f2fd;
      border-left-color: #2196f3;
    }

    .key-insight h4 {
      margin: 0 0 0.5rem 0;
      font-size: 0.95rem;
      color: #333;
    }

    .key-insight p {
      margin: 0.25rem 0;
      color: #555;
      line-height: 1.5;
    }

    .key-insight ul {
      margin: 0.5rem 0 0 1.5rem;
      color: #555;
    }

    .key-insight li {
      margin: 0.25rem 0;
    }

    /* Quick Stats */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 768px) {
      .quick-stats {
        grid-template-columns: 1fr;
      }
    }

    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.85rem;
      color: #666;
    }

    /* Export */
    .export-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid #eee;
    }

    .export-btn {
      background: #667eea;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .export-btn:hover {
      background: #5a6fd6;
    }

    .config-json {
      margin-top: 1rem;
      padding: 1rem;
      background: #2d3748;
      color: #68d391;
      border-radius: 8px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
      overflow-x: auto;
      display: none;
      white-space: pre-wrap;
      max-height: 300px;
    }

    .config-json.show {
      display: block;
    }

    /* Scrollbar styling */
    .dates-column::-webkit-scrollbar {
      width: 6px;
    }

    .dates-column::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .dates-column::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 10px;
    }

    .dates-column::-webkit-scrollbar-thumb:hover {
      background: #5a6fd6;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Hotel RMS Setup Tool</h1>
    <p>Smart Configuration Assistant for Dynamic Pricing</p>
  </div>

  <div class="container">
    <div class="nav-tabs">
      <a href="index.html" class="nav-tab" style="text-decoration:none;">Occupancy Based Pricing</a>
      <a href="inventory.html" class="nav-tab" style="text-decoration:none;">Inventory Reallocation</a>
      <a href="time-factors.html" class="nav-tab" style="text-decoration:none;">Time Based Factors</a>
      <a href="demand-factors.html" class="nav-tab active" style="text-decoration:none;">Demand Factors</a>
      <span class="nav-tab disabled">Market Demand</span>
      <span class="nav-tab disabled">Competition</span>
    </div>

    <!-- Step Indicator -->
    <div class="step-indicator">
      <div class="step active" id="step1">
        <div class="step-circle">1</div>
        <span class="step-label">Location & Type</span>
      </div>
      <div class="step-line" id="line1"></div>
      <div class="step" id="step2">
        <div class="step-circle">2</div>
        <span class="step-label">Demand Insights</span>
      </div>
    </div>

    <!-- Step 1: Location Input -->
    <div id="page1" class="card location-section">
      <h2><span class="card-icon">üìç</span> Configure Your Property</h2>
      <p>Select location and property type to get customized demand patterns, seasonal trends, and pricing strategies.</p>

      <div class="location-inputs">
        <select id="stateSelect" onchange="updateCities()">
          <option value="">Select State</option>
        </select>
        <select id="citySelect" disabled>
          <option value="">Select City</option>
        </select>
      </div>

      <h3 style="margin: 2rem 0 1rem 0; font-size: 1.1rem;">Select Property Type</h3>
      <div class="hotel-type-grid" id="hotelTypeGrid">
        <!-- Dynamic cards will be inserted here -->
      </div>

      <div class="loading" id="loadingIndicator">
        <div class="spinner"></div>
        <span>Analyzing demand patterns for your property...</span>
      </div>

      <button class="btn btn-primary" id="fetchBtn" onclick="fetchDemandData()" disabled>
        Get Demand Insights ‚Üí
      </button>
    </div>

    <!-- Step 2: Results -->
    <div id="page2" class="hidden">
      <div class="results-header">
        <h2>Demand Factors for Your Property</h2>
        <span class="location-badge" id="locationBadge">Mumbai, Maharashtra</span>
      </div>

      <!-- Key Insights -->
      <div id="keyInsights"></div>

      <!-- Quick Stats -->
      <div class="quick-stats" id="quickStats"></div>

      <!-- Factor Cards Grid -->
      <div class="factor-grid">
        <!-- Weekday Demand -->
        <div class="factor-card">
          <div class="factor-header">
            <div class="factor-header-title">
              <span>üìÖ</span> Weekday Demand
            </div>
          </div>
          <div class="factor-content">
            <table class="weekday-table" id="weekdayTable">
              <thead>
                <tr>
                  <th>Day</th>
                  <th>Demand</th>
                  <th>Score</th>
                  <th>Multiplier</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Monthly Seasons -->
        <div class="factor-card">
          <div class="factor-header">
            <div class="factor-header-title">
              <span>üóìÔ∏è</span> Seasonal Demand (1-15 Scale)
            </div>
          </div>
          <div class="factor-content">
            <div class="month-grid" id="monthGrid"></div>
          </div>
        </div>

        <!-- Special Dates & Long Weekends - FULL WIDTH -->
        <div class="factor-card factor-card-large">
          <div class="factor-header">
            <div class="factor-header-title">
              <span>üéâ</span> Special Dates & Long Weekends (2025-26)
            </div>
            <span class="count-badge" id="datesCount">0 Events</span>
          </div>
          <div class="factor-content">
            <div class="special-dates-container">
              <div class="dates-column">
                <h3>üî• Long Weekends (High Impact)</h3>
                <div id="longWeekendsList"></div>
              </div>
              <div class="dates-column">
                <h3>üìÖ Special Events & Festivals</h3>
                <div id="specialEventsList"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Export -->
      <div class="export-row">
        <button class="btn btn-secondary" onclick="goToStep(1)">‚Üê Change Settings</button>
        <button class="export-btn" onclick="toggleExport()">Export Configuration JSON</button>
      </div>
      <pre class="config-json" id="configJson"></pre>
    </div>
  </div>

  <script>
    // Enhanced States and Cities (80+ destinations)
    const statesAndCities = {
      'Maharashtra': ['Mumbai', 'Pune', 'Nagpur', 'Nashik', 'Aurangabad', 'Lonavala', 'Mahabaleshwar', 'Shirdi', 'Alibaug', 'Matheran', 'Khandala', 'Kolhapur', 'Pandharpur'],
      'Delhi': ['New Delhi', 'Gurgaon', 'Noida', 'Faridabad'],
      'Karnataka': ['Bangalore', 'Mysore', 'Mangalore', 'Hampi', 'Coorg', 'Gokarna', 'Hubli', 'Belgaum', 'Chikmagalur', 'Kabini', 'Dandeli', 'Sakleshpur', 'Udupi', 'Sringeri', 'Kollur'],
      'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai', 'Ooty', 'Kodaikanal', 'Pondicherry', 'Mamallapuram', 'Rameswaram', 'Kanyakumari', 'Thanjavur', 'Kumbakonam', 'Tiruchirappalli', 'Yercaud', 'Chettinad', 'Valparai'],
      'Kerala': ['Kochi', 'Thiruvananthapuram', 'Munnar', 'Alleppey', 'Kumarakom', 'Kovalam', 'Wayanad', 'Varkala', 'Thekkady'],
      'Rajasthan': ['Jaipur', 'Udaipur', 'Jodhpur', 'Jaisalmer', 'Pushkar', 'Mount Abu', 'Ranthambore', 'Bikaner', 'Ajmer', 'Chittorgarh', 'Bundi', 'Shekhawati'],
      'Goa': ['Panaji', 'Calangute', 'Candolim', 'Baga', 'Anjuna', 'Palolem', 'Vagator'],
      'Uttar Pradesh': ['Lucknow', 'Agra', 'Varanasi', 'Mathura', 'Vrindavan', 'Allahabad', 'Ayodhya', 'Chitrakoot', 'Vindhyachal', 'Sarnath', 'Fatehpur Sikri'],
      'West Bengal': ['Kolkata', 'Darjeeling', 'Siliguri', 'Digha', 'Sundarbans'],
      'Gujarat': ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Dwarka', 'Somnath', 'Kutch', 'Gir'],
      'Himachal Pradesh': ['Shimla', 'Manali', 'Dharamshala', 'Dalhousie', 'Kasol', 'Kullu', 'Spiti', 'McLeod Ganj'],
      'Uttarakhand': ['Dehradun', 'Mussoorie', 'Nainital', 'Rishikesh', 'Haridwar', 'Jim Corbett', 'Kedarnath', 'Badrinath', 'Gangotri', 'Yamunotri', 'Auli', 'Chopta'],
      'Telangana': ['Hyderabad', 'Warangal'],
      'Andhra Pradesh': ['Visakhapatnam', 'Vijayawada', 'Tirupati'],
      'Punjab': ['Amritsar', 'Chandigarh', 'Ludhiana'],
      'Madhya Pradesh': ['Bhopal', 'Indore', 'Khajuraho', 'Ujjain', 'Kanha', 'Bandhavgarh', 'Pench', 'Satpura', 'Panna', 'Orchha', 'Gwalior', 'Mandu', 'Maheshwar'],
      'Odisha': ['Bhubaneswar', 'Puri', 'Konark'],
      'Assam': ['Guwahati', 'Kaziranga', 'Tezpur', 'Jorhat'],
      'Meghalaya': ['Shillong', 'Cherrapunji', 'Mawlynnong'],
      'Sikkim': ['Gangtok', 'Pelling'],
      'Arunachal Pradesh': ['Tawang', 'Ziro'],
      'Jammu & Kashmir': ['Srinagar', 'Gulmarg', 'Pahalgam', 'Leh', 'Ladakh'],
      'Andaman & Nicobar': ['Port Blair', 'Havelock Island', 'Neil Island']
    };

    // Hotel Types with definitions
    const hotelTypes = [
      { id: 'business', icon: 'üè¢', name: 'Business Hotel', description: 'Corporate travelers, MICE, city center properties', pattern: 'metro_business' },
      { id: 'leisure', icon: 'üèñÔ∏è', name: 'Leisure/Resort', description: 'Families, couples, weekend travelers', pattern: 'leisure' },
      { id: 'hillstation', icon: '‚õ∞Ô∏è', name: 'Hill Station', description: 'Mountain resorts, cool climate destinations', pattern: 'hill_station' },
      { id: 'beach', icon: 'üèùÔ∏è', name: 'Beach Resort', description: 'Coastal properties, water sports, seaside', pattern: 'beach' },
      { id: 'pilgrimage', icon: 'üïâÔ∏è', name: 'Pilgrimage/Religious', description: 'Temple towns, spiritual destinations', pattern: 'pilgrimage' },
      { id: 'wildlife', icon: 'üêÖ', name: 'Wildlife Lodge', description: 'Safari properties, national parks', pattern: 'wildlife' },
      { id: 'heritage', icon: 'üèõÔ∏è', name: 'Heritage/Boutique', description: 'Palaces, havelis, experiential stays', pattern: 'heritage' },
      { id: 'budget', icon: 'üí∞', name: 'Budget/Economy', description: 'Value travelers, consistent base demand', pattern: 'budget' }
    ];

    // Demand patterns (same as before - keeping for brevity, using exact same data structure)
    const demandPatterns = {
      metro_business: {
        weekdays: {
          'Monday': { demand: 'high', score: 11, multiplier: 1.1 },
          'Tuesday': { demand: 'high', score: 12, multiplier: 1.15 },
          'Wednesday': { demand: 'high', score: 12, multiplier: 1.15 },
          'Thursday': { demand: 'high', score: 11, multiplier: 1.1 },
          'Friday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Saturday': { demand: 'low', score: 6, multiplier: 0.85 },
          'Sunday': { demand: 'low', score: 5, multiplier: 0.8 }
        },
        months: {
          'Jan': { score: 11, demand: 'high', reasoning: 'Post-holiday corporate activity' },
          'Feb': { score: 12, demand: 'high', reasoning: 'Budget allocations, conferences' },
          'Mar': { score: 13, demand: 'peak', reasoning: 'Q4 fiscal year-end' },
          'Apr': { score: 8, demand: 'normal', reasoning: 'New fiscal year start' },
          'May': { score: 6, demand: 'low', reasoning: 'Summer lull' },
          'Jun': { score: 7, demand: 'normal', reasoning: 'Monsoon, stable' },
          'Jul': { score: 9, demand: 'normal', reasoning: 'Mid-year reviews' },
          'Aug': { score: 10, demand: 'high', reasoning: 'Post-monsoon pickup' },
          'Sep': { score: 12, demand: 'high', reasoning: 'Conference season' },
          'Oct': { score: 13, demand: 'peak', reasoning: 'Festival season business' },
          'Nov': { score: 12, demand: 'high', reasoning: 'Pre-holiday rush' },
          'Dec': { score: 9, demand: 'normal', reasoning: 'Year-end, leisure mix' }
        }
      },
      leisure: {
        weekdays: {
          'Monday': { demand: 'low', score: 6, multiplier: 0.85 },
          'Tuesday': { demand: 'low', score: 6, multiplier: 0.85 },
          'Wednesday': { demand: 'normal', score: 8, multiplier: 0.95 },
          'Thursday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Friday': { demand: 'high', score: 11, multiplier: 1.15 },
          'Saturday': { demand: 'peak', score: 14, multiplier: 1.3 },
          'Sunday': { demand: 'high', score: 11, multiplier: 1.1 }
        },
        months: {
          'Jan': { score: 14, demand: 'peak', reasoning: 'Winter peak, holidays' },
          'Feb': { score: 13, demand: 'peak', reasoning: 'Valentine\'s, winter continues' },
          'Mar': { score: 12, demand: 'high', reasoning: 'Holi season, pre-summer' },
          'Apr': { score: 10, demand: 'high', reasoning: 'Summer starts' },
          'May': { score: 7, demand: 'normal', reasoning: 'Peak summer heat' },
          'Jun': { score: 4, demand: 'low', reasoning: 'Monsoon begins' },
          'Jul': { score: 3, demand: 'very-low', reasoning: 'Heavy monsoon' },
          'Aug': { score: 4, demand: 'low', reasoning: 'Monsoon continues' },
          'Sep': { score: 8, demand: 'normal', reasoning: 'Monsoon retreats' },
          'Oct': { score: 12, demand: 'high', reasoning: 'Diwali season' },
          'Nov': { score: 14, demand: 'peak', reasoning: 'Wedding season peak' },
          'Dec': { score: 15, demand: 'peak', reasoning: 'Christmas/New Year peak' }
        }
      },
      hill_station: {
        weekdays: {
          'Monday': { demand: 'low', score: 5, multiplier: 0.8 },
          'Tuesday': { demand: 'low', score: 5, multiplier: 0.8 },
          'Wednesday': { demand: 'normal', score: 7, multiplier: 0.9 },
          'Thursday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Friday': { demand: 'high', score: 12, multiplier: 1.2 },
          'Saturday': { demand: 'peak', score: 15, multiplier: 1.4 },
          'Sunday': { demand: 'high', score: 12, multiplier: 1.15 }
        },
        months: {
          'Jan': { score: 6, demand: 'low', reasoning: 'Too cold (except snow destinations)' },
          'Feb': { score: 8, demand: 'normal', reasoning: 'Winter tourism' },
          'Mar': { score: 12, demand: 'high', reasoning: 'Spring flowers, pleasant' },
          'Apr': { score: 14, demand: 'peak', reasoning: 'Pre-summer rush' },
          'May': { score: 15, demand: 'peak', reasoning: 'Summer vacation peak' },
          'Jun': { score: 13, demand: 'peak', reasoning: 'Early monsoon, still popular' },
          'Jul': { score: 8, demand: 'normal', reasoning: 'Heavy rains' },
          'Aug': { score: 7, demand: 'normal', reasoning: 'Monsoon continues' },
          'Sep': { score: 10, demand: 'high', reasoning: 'Post-monsoon greenery' },
          'Oct': { score: 13, demand: 'peak', reasoning: 'Autumn, Diwali season' },
          'Nov': { score: 9, demand: 'normal', reasoning: 'Gets cold' },
          'Dec': { score: 11, demand: 'high', reasoning: 'Christmas/New Year' }
        }
      },
      beach: {
        weekdays: {
          'Monday': { demand: 'low', score: 6, multiplier: 0.85 },
          'Tuesday': { demand: 'low', score: 6, multiplier: 0.85 },
          'Wednesday': { demand: 'normal', score: 8, multiplier: 0.95 },
          'Thursday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Friday': { demand: 'high', score: 12, multiplier: 1.2 },
          'Saturday': { demand: 'peak', score: 14, multiplier: 1.35 },
          'Sunday': { demand: 'high', score: 11, multiplier: 1.1 }
        },
        months: {
          'Jan': { score: 14, demand: 'peak', reasoning: 'Winter peak season' },
          'Feb': { score: 13, demand: 'peak', reasoning: 'Winter continues' },
          'Mar': { score: 12, demand: 'high', reasoning: 'Pre-summer season' },
          'Apr': { score: 10, demand: 'high', reasoning: 'Gets hot' },
          'May': { score: 7, demand: 'normal', reasoning: 'Too hot for beaches' },
          'Jun': { score: 4, demand: 'low', reasoning: 'Monsoon begins' },
          'Jul': { score: 3, demand: 'very-low', reasoning: 'Heavy monsoon' },
          'Aug': { score: 4, demand: 'low', reasoning: 'Monsoon continues' },
          'Sep': { score: 8, demand: 'normal', reasoning: 'Monsoon retreats' },
          'Oct': { score: 12, demand: 'high', reasoning: 'Festival season' },
          'Nov': { score: 14, demand: 'peak', reasoning: 'Peak beach season' },
          'Dec': { score: 15, demand: 'peak', reasoning: 'Christmas/New Year peak' }
        }
      },
      pilgrimage: {
        weekdays: {
          'Monday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Tuesday': { demand: 'high', score: 10, multiplier: 1.1 },
          'Wednesday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Thursday': { demand: 'high', score: 10, multiplier: 1.1 },
          'Friday': { demand: 'high', score: 11, multiplier: 1.15 },
          'Saturday': { demand: 'peak', score: 13, multiplier: 1.25 },
          'Sunday': { demand: 'peak', score: 12, multiplier: 1.2 }
        },
        months: {
          'Jan': { score: 11, demand: 'high', reasoning: 'Makar Sankranti' },
          'Feb': { score: 9, demand: 'normal', reasoning: 'Moderate season' },
          'Mar': { score: 12, demand: 'high', reasoning: 'Maha Shivaratri, Holi' },
          'Apr': { score: 10, demand: 'high', reasoning: 'Summer pilgrimages' },
          'May': { score: 8, demand: 'normal', reasoning: 'Hot, reduced footfall' },
          'Jun': { score: 5, demand: 'low', reasoning: 'Monsoon, least pilgrimages' },
          'Jul': { score: 9, demand: 'normal', reasoning: 'Shravan month' },
          'Aug': { score: 12, demand: 'high', reasoning: 'Shravan, Janmashtami' },
          'Sep': { score: 11, demand: 'high', reasoning: 'Pitru Paksha, Navratri prep' },
          'Oct': { score: 14, demand: 'peak', reasoning: 'Navratri, Dussehra' },
          'Nov': { score: 15, demand: 'peak', reasoning: 'Diwali, Kartik month' },
          'Dec': { score: 10, demand: 'high', reasoning: 'Winter pilgrimages' }
        }
      },
      wildlife: {
        weekdays: {
          'Monday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Tuesday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Wednesday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Thursday': { demand: 'high', score: 10, multiplier: 1.05 },
          'Friday': { demand: 'high', score: 11, multiplier: 1.1 },
          'Saturday': { demand: 'peak', score: 13, multiplier: 1.25 },
          'Sunday': { demand: 'high', score: 11, multiplier: 1.15 }
        },
        months: {
          'Jan': { score: 14, demand: 'peak', reasoning: 'Winter peak, best sightings' },
          'Feb': { score: 15, demand: 'peak', reasoning: 'Peak season continues' },
          'Mar': { score: 14, demand: 'peak', reasoning: 'Last of peak season' },
          'Apr': { score: 13, demand: 'peak', reasoning: 'Hot but good sightings' },
          'May': { score: 11, demand: 'high', reasoning: 'Very hot, water holes' },
          'Jun': { score: 2, demand: 'very-low', reasoning: 'Parks closed - monsoon' },
          'Jul': { score: 2, demand: 'very-low', reasoning: 'Parks closed' },
          'Aug': { score: 2, demand: 'very-low', reasoning: 'Parks closed' },
          'Sep': { score: 2, demand: 'very-low', reasoning: 'Parks closed' },
          'Oct': { score: 10, demand: 'high', reasoning: 'Parks reopen' },
          'Nov': { score: 13, demand: 'peak', reasoning: 'Peak season returns' },
          'Dec': { score: 14, demand: 'peak', reasoning: 'Christmas holidays' }
        }
      },
      heritage: {
        weekdays: {
          'Monday': { demand: 'low', score: 7, multiplier: 0.9 },
          'Tuesday': { demand: 'low', score: 7, multiplier: 0.9 },
          'Wednesday': { demand: 'normal', score: 8, multiplier: 0.95 },
          'Thursday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Friday': { demand: 'high', score: 11, multiplier: 1.15 },
          'Saturday': { demand: 'peak', score: 13, multiplier: 1.3 },
          'Sunday': { demand: 'high', score: 11, multiplier: 1.1 }
        },
        months: {
          'Jan': { score: 13, demand: 'peak', reasoning: 'Winter weddings, heritage tourism' },
          'Feb': { score: 12, demand: 'high', reasoning: 'Wedding season continues' },
          'Mar': { score: 11, demand: 'high', reasoning: 'Pre-summer heritage visits' },
          'Apr': { score: 9, demand: 'normal', reasoning: 'Gets hot' },
          'May': { score: 7, demand: 'normal', reasoning: 'Summer heat' },
          'Jun': { score: 5, demand: 'low', reasoning: 'Monsoon begins' },
          'Jul': { score: 5, demand: 'low', reasoning: 'Monsoon continues' },
          'Aug': { score: 6, demand: 'low', reasoning: 'Monsoon ends' },
          'Sep': { score: 9, demand: 'normal', reasoning: 'Post-monsoon' },
          'Oct': { score: 12, demand: 'high', reasoning: 'Diwali, festival weddings' },
          'Nov': { score: 14, demand: 'peak', reasoning: 'Peak wedding season' },
          'Dec': { score: 15, demand: 'peak', reasoning: 'Destination weddings peak' }
        }
      },
      budget: {
        weekdays: {
          'Monday': { demand: 'normal', score: 9, multiplier: 0.98 },
          'Tuesday': { demand: 'normal', score: 9, multiplier: 0.98 },
          'Wednesday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Thursday': { demand: 'normal', score: 9, multiplier: 1.0 },
          'Friday': { demand: 'normal', score: 10, multiplier: 1.05 },
          'Saturday': { demand: 'high', score: 10, multiplier: 1.08 },
          'Sunday': { demand: 'high', score: 10, multiplier: 1.05 }
        },
        months: {
          'Jan': { score: 10, demand: 'high', reasoning: 'Holiday overflow' },
          'Feb': { score: 9, demand: 'normal', reasoning: 'Base demand' },
          'Mar': { score: 11, demand: 'high', reasoning: 'Festival season' },
          'Apr': { score: 9, demand: 'normal', reasoning: 'Stable' },
          'May': { score: 8, demand: 'normal', reasoning: 'Summer dip' },
          'Jun': { score: 8, demand: 'normal', reasoning: 'Monsoon stability' },
          'Jul': { score: 9, demand: 'normal', reasoning: 'Consistent' },
          'Aug': { score: 9, demand: 'normal', reasoning: 'Steady' },
          'Sep': { score: 10, demand: 'high', reasoning: 'Festival season' },
          'Oct': { score: 12, demand: 'high', reasoning: 'Diwali peak' },
          'Nov': { score: 11, demand: 'high', reasoning: 'Wedding spillover' },
          'Dec': { score: 10, demand: 'high', reasoning: 'Holiday season' }
        }
      }
    };

    // City to pattern mapping (same as before)
    const cityPatterns = {
      'Mumbai': 'metro_business', 'New Delhi': 'metro_business', 'Bangalore': 'metro_business',
      'Chennai': 'metro_business', 'Kolkata': 'metro_business', 'Hyderabad': 'metro_business',
      'Pune': 'metro_business', 'Ahmedabad': 'metro_business', 'Gurgaon': 'metro_business',
      'Noida': 'metro_business', 'Nagpur': 'metro_business', 'Nashik': 'metro_business',
      'Hubli': 'metro_business', 'Belgaum': 'metro_business',
      'Shimla': 'hill_station', 'Manali': 'hill_station', 'Mussoorie': 'hill_station',
      'Nainital': 'hill_station', 'Darjeeling': 'hill_station', 'Ooty': 'hill_station',
      'Kodaikanal': 'hill_station', 'Munnar': 'hill_station', 'Coorg': 'hill_station',
      'Mahabaleshwar': 'hill_station', 'Lonavala': 'hill_station', 'Mount Abu': 'hill_station',
      'Dharamshala': 'hill_station', 'Dalhousie': 'hill_station', 'Kasol': 'hill_station',
      'Wayanad': 'hill_station', 'Spiti': 'hill_station', 'Leh': 'hill_station',
      'Ladakh': 'hill_station', 'Gulmarg': 'hill_station', 'Pahalgam': 'hill_station',
      'Chikmagalur': 'hill_station', 'Sakleshpur': 'hill_station', 'Yercaud': 'hill_station',
      'Valparai': 'hill_station', 'Auli': 'hill_station', 'Chopta': 'hill_station',
      'McLeod Ganj': 'hill_station', 'Gangtok': 'hill_station', 'Pelling': 'hill_station',
      'Tawang': 'hill_station', 'Ziro': 'hill_station', 'Shillong': 'hill_station',
      'Cherrapunji': 'hill_station', 'Mawlynnong': 'hill_station',
      'Goa': 'beach', 'Panaji': 'beach', 'Calangute': 'beach', 'Candolim': 'beach',
      'Baga': 'beach', 'Anjuna': 'beach', 'Palolem': 'beach', 'Vagator': 'beach',
      'Kovalam': 'beach', 'Alleppey': 'beach', 'Kumarakom': 'beach', 'Gokarna': 'beach',
      'Visakhapatnam': 'beach', 'Puri': 'beach', 'Digha': 'beach', 'Pondicherry': 'beach',
      'Mamallapuram': 'beach', 'Varkala': 'beach', 'Port Blair': 'beach',
      'Havelock Island': 'beach', 'Neil Island': 'beach', 'Kanyakumari': 'beach',
      'Varanasi': 'pilgrimage', 'Haridwar': 'pilgrimage', 'Rishikesh': 'pilgrimage',
      'Tirupati': 'pilgrimage', 'Shirdi': 'pilgrimage', 'Mathura': 'pilgrimage',
      'Vrindavan': 'pilgrimage', 'Amritsar': 'pilgrimage', 'Dwarka': 'pilgrimage',
      'Somnath': 'pilgrimage', 'Ujjain': 'pilgrimage', 'Ayodhya': 'pilgrimage',
      'Allahabad': 'pilgrimage', 'Pushkar': 'pilgrimage', 'Pandharpur': 'pilgrimage',
      'Udupi': 'pilgrimage', 'Sringeri': 'pilgrimage', 'Kollur': 'pilgrimage',
      'Rameswaram': 'pilgrimage', 'Kumbakonam': 'pilgrimage', 'Thanjavur': 'pilgrimage',
      'Kedarnath': 'pilgrimage', 'Badrinath': 'pilgrimage', 'Gangotri': 'pilgrimage',
      'Yamunotri': 'pilgrimage', 'Chitrakoot': 'pilgrimage', 'Vindhyachal': 'pilgrimage',
      'Sarnath': 'pilgrimage',
      'Jim Corbett': 'wildlife', 'Ranthambore': 'wildlife', 'Kaziranga': 'wildlife',
      'Kanha': 'wildlife', 'Bandhavgarh': 'wildlife', 'Kabini': 'wildlife',
      'Thekkady': 'wildlife', 'Pench': 'wildlife', 'Satpura': 'wildlife',
      'Panna': 'wildlife', 'Gir': 'wildlife', 'Dandeli': 'wildlife',
      'Sundarbans': 'wildlife',
      'Jaipur': 'heritage', 'Udaipur': 'heritage', 'Jodhpur': 'heritage',
      'Jaisalmer': 'heritage', 'Agra': 'leisure', 'Mysore': 'heritage',
      'Hampi': 'heritage', 'Khajuraho': 'heritage', 'Srinagar': 'leisure',
      'Bikaner': 'heritage', 'Ajmer': 'heritage', 'Chittorgarh': 'heritage',
      'Bundi': 'heritage', 'Shekhawati': 'heritage', 'Orchha': 'heritage',
      'Gwalior': 'heritage', 'Mandu': 'heritage', 'Maheshwar': 'heritage',
      'Chettinad': 'heritage', 'Fatehpur Sikri': 'heritage'
    };

    // Special dates with enhanced strategic advice
    const specialDates2025 = [
      { name: 'Republic Day Weekend', start: '2025-01-25', end: '2025-01-26', multiplier: 1.25, isLongWeekend: true, duration: 2, strategy: 'Patriotic tourism spike. Target domestic families.' },
      { name: 'Holi Weekend', start: '2025-03-14', end: '2025-03-16', multiplier: 1.3, isLongWeekend: true, duration: 3, strategy: 'Leisure destinations peak. City hotels may dip. Packages recommended.' },
      { name: 'Good Friday Weekend', start: '2025-04-18', end: '2025-04-20', multiplier: 1.25, isLongWeekend: true, duration: 3, strategy: 'Christian community travel. Beach and hill stations popular.' },
      { name: 'Baisakhi / Tamil New Year', start: '2025-04-13', end: '2025-04-14', multiplier: 1.2, isLongWeekend: true, duration: 2, strategy: 'Regional surge in Punjab and Tamil Nadu properties.' },
      { name: 'May Day Extended Weekend', start: '2025-05-01', end: '2025-05-04', multiplier: 1.35, isLongWeekend: true, duration: 4, strategy: 'Summer vacation kickoff. Hill stations at capacity. Minimum 2-3 night stay.' },
      { name: 'Independence Day Weekend', start: '2025-08-15', end: '2025-08-17', multiplier: 1.25, isLongWeekend: true, duration: 3, strategy: 'Patriotic destinations (Delhi, Amritsar) see surge. Heritage properties benefit.' },
      { name: 'Gandhi Jayanti Extended Weekend', start: '2025-10-02', end: '2025-10-05', multiplier: 1.3, isLongWeekend: true, duration: 4, strategy: 'Coincides with Navratri. Implement dynamic pricing and minimum stays.' },
      { name: 'Christmas Extended Weekend', start: '2025-12-24', end: '2025-12-28', multiplier: 1.4, isLongWeekend: true, duration: 5, strategy: 'Peak winter season. Beach and hill stations at maximum rates. Book months in advance.' },
      { name: 'New Year 2026 Extended', start: '2025-12-31', end: '2026-01-02', multiplier: 1.5, isLongWeekend: true, duration: 3, strategy: 'Absolute peak. Premium positioning. Gala dinners, entertainment packages essential.' },
      { name: 'Republic Day 2026 Weekend', start: '2026-01-25', end: '2026-01-26', multiplier: 1.25, isLongWeekend: true, duration: 2, strategy: 'Repeat of Jan 2025 pattern.' },
      { name: 'Summer Vacation Peak', start: '2025-05-01', end: '2025-05-15', multiplier: 1.3, isLongWeekend: false, strategy: 'School holidays. Family packages. Hill stations saturated.' },
      { name: 'Eid ul-Fitr', start: '2025-03-30', end: '2025-03-31', multiplier: 1.15, isLongWeekend: false, strategy: 'Muslim community travel. Halal-certified properties benefit.' },
      { name: 'Raksha Bandhan', start: '2025-08-09', end: '2025-08-09', multiplier: 1.1, isLongWeekend: false, strategy: 'Short family visits. 1-2 night stays.' },
      { name: 'Janmashtami', start: '2025-08-16', end: '2025-08-16', multiplier: 1.1, isLongWeekend: false, strategy: 'Mathura-Vrindavan pilgrimage surge.' },
      { name: 'Navratri Season', start: '2025-09-29', end: '2025-10-07', multiplier: 1.15, isLongWeekend: false, strategy: '9-day festival. Garba events in Gujarat. Extended bookings.' },
      { name: 'Durga Puja', start: '2025-10-01', end: '2025-10-04', multiplier: 1.25, isLongWeekend: false, strategy: 'Bengal region peak. Kolkata properties premium rates.' },
      { name: 'Dussehra', start: '2025-10-02', end: '2025-10-02', multiplier: 1.2, isLongWeekend: false, strategy: 'North India celebrates. Mysore Dasara famous.' },
      { name: 'Diwali Week', start: '2025-10-19', end: '2025-10-25', multiplier: 1.4, isLongWeekend: false, strategy: 'Festival of Lights. Peak domestic travel. Premium rates justified.' },
      { name: 'Pongal/Makar Sankranti', start: '2026-01-14', end: '2026-01-16', multiplier: 1.15, isLongWeekend: false, strategy: 'Tamil Nadu harvest festival. Regional surge.' }
    ];

    const regionalDates = {
      'Goa': [
        { name: 'Goa Carnival', start: '2025-02-28', end: '2025-03-04', multiplier: 1.4, isLongWeekend: false, strategy: 'Unique Goan celebration. Beach shacks and parties. Book early.' },
        { name: 'Sunburn Festival', start: '2025-12-27', end: '2025-12-29', multiplier: 1.5, isLongWeekend: false, strategy: 'Asia\'s biggest EDM festival. Youth demographic. Premium rates.' }
      ],
      'Kerala': [
        { name: 'Onam', start: '2025-09-04', end: '2025-09-07', multiplier: 1.3, isLongWeekend: false, strategy: 'Kerala\'s harvest festival. Cultural tourism peak.' }
      ],
      'West Bengal': [
        { name: 'Durga Puja (Regional Peak)', start: '2025-10-01', end: '2025-10-06', multiplier: 1.5, isLongWeekend: false, strategy: 'Kolkata transforms. Pandal hopping. Book months ahead.' }
      ],
      'Tamil Nadu': [
        { name: 'Pongal', start: '2026-01-14', end: '2026-01-17', multiplier: 1.3, isLongWeekend: false, strategy: 'Harvest festival. Family gatherings drive domestic travel.' }
      ],
      'Punjab': [
        { name: 'Baisakhi', start: '2025-04-13', end: '2025-04-14', multiplier: 1.25, isLongWeekend: false, strategy: 'Sikh new year. Golden Temple sees massive footfall.' },
        { name: 'Guru Nanak Jayanti', start: '2025-11-05', end: '2025-11-05', multiplier: 1.3, isLongWeekend: false, strategy: 'Founder\'s birthday. Amritsar fully booked.' }
      ],
      'Gujarat': [
        { name: 'Navratri Garba', start: '2025-09-29', end: '2025-10-07', multiplier: 1.4, isLongWeekend: false, strategy: '9 nights of Garba. Ahmedabad event tourism.' },
        { name: 'Rann Utsav', start: '2025-11-01', end: '2026-02-28', multiplier: 1.3, isLongWeekend: false, strategy: '4-month cultural festival. Kutch tourism peak.' }
      ],
      'Rajasthan': [
        { name: 'Pushkar Fair', start: '2025-11-05', end: '2025-11-09', multiplier: 1.5, isLongWeekend: false, strategy: 'Iconic camel fair. Pushkar hotels 100% occupancy.' },
        { name: 'Desert Festival Jaisalmer', start: '2025-02-21', end: '2025-02-23', multiplier: 1.3, isLongWeekend: false, strategy: 'Desert culture showcase. Jaisalmer premium rates.' }
      ]
    };

    let currentStep = 1;
    let demandData = null;
    let selectedHotelType = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      const stateSelect = document.getElementById('stateSelect');
      Object.keys(statesAndCities).sort().forEach(state => {
        const option = document.createElement('option');
        option.value = state;
        option.textContent = state;
        stateSelect.appendChild(option);
      });

      const hotelTypeGrid = document.getElementById('hotelTypeGrid');
      hotelTypes.forEach(type => {
        const card = document.createElement('div');
        card.className = 'hotel-type-card';
        card.dataset.type = type.id;
        card.innerHTML = `<h3>${type.icon} ${type.name}</h3><p>${type.description}</p>`;
        card.onclick = () => selectHotelType(type.id);
        hotelTypeGrid.appendChild(card);
      });
    });

    function updateCities() {
      const state = document.getElementById('stateSelect').value;
      const citySelect = document.getElementById('citySelect');
      citySelect.innerHTML = '<option value="">Select City</option>';
      if (state && statesAndCities[state]) {
        statesAndCities[state].forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
        citySelect.disabled = false;
      } else {
        citySelect.disabled = true;
      }
      citySelect.onchange = () => updateFetchButtonState();
    }

    function selectHotelType(typeId) {
      selectedHotelType = typeId;
      document.querySelectorAll('.hotel-type-card').forEach(card => card.classList.remove('selected'));
      document.querySelector(`[data-type="${typeId}"]`).classList.add('selected');
      updateFetchButtonState();
    }

    function updateFetchButtonState() {
      const city = document.getElementById('citySelect').value;
      document.getElementById('fetchBtn').disabled = !(city && selectedHotelType);
    }

    function goToStep(step) {
      document.getElementById(`page${currentStep}`).classList.add('hidden');
      document.getElementById(`page${step}`).classList.remove('hidden');
      for (let i = 1; i <= 2; i++) {
        const stepEl = document.getElementById(`step${i}`);
        const lineEl = document.getElementById(`line${i}`);
        if (stepEl) stepEl.classList.remove('active', 'completed');
        if (lineEl) lineEl.classList.remove('completed');
        if (i < step) {
          if (stepEl) stepEl.classList.add('completed');
          if (lineEl) lineEl.classList.add('completed');
        } else if (i === step) {
          if (stepEl) stepEl.classList.add('active');
        }
      }
      currentStep = step;
    }

    function fetchDemandData() {
      const state = document.getElementById('stateSelect').value;
      const city = document.getElementById('citySelect').value;
      const hotelType = selectedHotelType;
      if (!city || !hotelType) return;

      document.getElementById('loadingIndicator').classList.add('show');
      document.getElementById('fetchBtn').disabled = true;

      setTimeout(() => {
        const typePattern = hotelTypes.find(t => t.id === hotelType).pattern;
        let patternKey = cityPatterns[city] || typePattern;
        if (typePattern && cityPatterns[city] !== typePattern) patternKey = typePattern;
        const pattern = demandPatterns[patternKey];

        let specialDates = [...specialDates2025];
        if (regionalDates[state]) specialDates = [...specialDates, ...regionalDates[state]];
        specialDates = specialDates.filter((date, index, self) =>
          index === self.findIndex((d) => d.name === date.name && d.start === date.start)
        );
        specialDates.sort((a, b) => new Date(a.start) - new Date(b.start));

        demandData = {
          location: { state, city },
          hotelType,
          hotelTypeName: hotelTypes.find(t => t.id === hotelType).name,
          patternType: patternKey,
          weekdays: pattern.weekdays,
          months: pattern.months,
          specialDates
        };

        document.getElementById('loadingIndicator').classList.remove('show');
        document.getElementById('fetchBtn').disabled = false;
        renderResults();
        goToStep(2);
      }, 1500);
    }

    function getDemandClass(score) {
      if (score >= 13) return 'peak';
      if (score >= 10) return 'high';
      if (score >= 7) return 'normal';
      if (score >= 4) return 'low';
      return 'very-low';
    }

    function getDemandLabel(score) {
      if (score >= 13) return 'Peak';
      if (score >= 10) return 'High';
      if (score >= 7) return 'Normal';
      if (score >= 4) return 'Low';
      return 'Very Low';
    }

    function generateInsights() {
      const { patternType, specialDates, hotelTypeName, location } = demandData;
      let insights = '';

      if (patternType === 'metro_business') {
        insights += `<div class="key-insight"><h4>üè¢ Business Destination Pattern</h4>
          <p><strong>Your ${hotelTypeName}</strong> follows corporate travel patterns. Weekdays (Mon-Thu) see highest demand with scores of 11-12/15.</p>
          <p><strong>Strategy:</strong> Focus on corporate rates and contracts. Offer weekend leisure packages at 15-20% discount to fill rooms. Target Q-end months (Mar, Sep-Oct) for premium pricing.</p></div>`;
      } else if (patternType === 'hill_station' || patternType === 'beach' || patternType === 'leisure') {
        insights += `<div class="key-insight warning"><h4>üèñÔ∏è Leisure Destination Pattern</h4>
          <p><strong>Your ${hotelTypeName}</strong> peaks during weekends and holidays. Friday-Saturday see 30-40% higher demand.</p>
          <p><strong>Strategy:</strong> Implement weekend premiums and minimum stay requirements. Keep weekday rates flexible. Focus on couple packages and family deals during peak seasons (scores 13-15).</p></div>`;
      } else if (patternType === 'pilgrimage') {
        insights += `<div class="key-insight"><h4>üïâÔ∏è Pilgrimage Destination Pattern</h4>
          <p><strong>Your ${hotelTypeName}</strong> is driven by religious festivals and auspicious dates rather than weekday patterns.</p>
          <p><strong>Strategy:</strong> Monitor temple calendars for Ekadashi, Purnima, and festival dates. Plan inventory around major pilgrimages. Group bookings are common‚Äîoffer bulk discounts.</p></div>`;
      } else if (patternType === 'wildlife') {
        insights += `<div class="key-insight warning"><h4>üêÖ Wildlife Lodge Pattern</h4>
          <p><strong>Your ${hotelTypeName}</strong> has distinct on-season (Oct-May) and off-season (Jun-Sep when parks close).</p>
          <p><strong>Strategy:</strong> Maximize revenue during open season. Consider complete closure or maintenance Jun-Sep. Peak pricing during Feb-Mar for best sightings.</p></div>`;
      } else if (patternType === 'heritage') {
        insights += `<div class="key-insight info"><h4>üèõÔ∏è Heritage Property Pattern</h4>
          <p><strong>Your ${hotelTypeName}</strong> sees strong demand during wedding seasons and experiential travel periods.</p>
          <p><strong>Strategy:</strong> Focus on destination weddings (Nov-Feb). Premium positioning for photography shoots and cultural experiences. Leverage social media appeal.</p></div>`;
      }

      const upcomingLongWeekends = specialDates.filter(d => d.isLongWeekend && new Date(d.start) >= new Date()).slice(0, 3);
      if (upcomingLongWeekends.length > 0) {
        insights += `<div class="key-insight warning"><h4>üéØ Upcoming Long Weekends (Next 90 Days)</h4>`;
        upcomingLongWeekends.forEach(lw => {
          const increase = Math.round((lw.multiplier - 1) * 100);
          insights += `<p><strong>${lw.name}:</strong> ${lw.duration}-day weekend. Expect +${increase}% demand. ${lw.duration >= 4 ? 'Consider 2-3 night minimum stay.' : 'Implement dynamic pricing.'}</p>`;
        });
        insights += `</div>`;
      }

      const currentMonth = new Date().toLocaleString('en-US', { month: 'short' });
      const currentMonthData = demandData.months[currentMonth];
      if (currentMonthData) {
        insights += `<div class="key-insight info"><h4>üìä Current Season: ${getDemandLabel(currentMonthData.score)} Demand (Score: ${currentMonthData.score}/15)</h4>
          <p><strong>Reasoning:</strong> ${currentMonthData.reasoning}</p>
          <p><strong>Strategy:</strong> ${
            currentMonthData.score >= 13 ? 'Maximize rates. Implement dynamic pricing for last-minute bookings. Enforce minimum stay policies.' :
            currentMonthData.score >= 10 ? 'Maintain premium rates. Monitor competition. Reward advance bookings.' :
            currentMonthData.score >= 7 ? 'Hold base rates. Offer value-add packages. Focus on direct bookings.' :
            currentMonthData.score >= 4 ? 'Selective discounting. Target domestic markets. Invest in marketing.' :
            'Deep promotional rates. Partner with OTAs. Consider seasonal closure or renovation.'
          }</p></div>`;
      }
      return insights;
    }

    function renderResults() {
      const { location, hotelTypeName, weekdays, months, specialDates } = demandData;
      document.getElementById('locationBadge').textContent = `${location.city}, ${location.state} ‚Ä¢ ${hotelTypeName}`;
      document.getElementById('keyInsights').innerHTML = generateInsights();

      // Quick Stats
      const longWeekends = specialDates.filter(d => d.isLongWeekend).length;
      const peakMonths = Object.values(months).filter(m => m.score >= 13).length;
      const avgScore = Math.round(Object.values(months).reduce((sum, m) => sum + m.score, 0) / 12);
      document.getElementById('quickStats').innerHTML = `
        <div class="stat-card"><div class="stat-value">${longWeekends}</div><div class="stat-label">Long Weekends</div></div>
        <div class="stat-card"><div class="stat-value">${peakMonths}</div><div class="stat-label">Peak Months</div></div>
        <div class="stat-card"><div class="stat-value">${avgScore}/15</div><div class="stat-label">Avg Demand Score</div></div>
      `;

      // Weekday table
      const weekdayTbody = document.querySelector('#weekdayTable tbody');
      let weekdayHtml = '';
      Object.entries(weekdays).forEach(([day, data]) => {
        const demandClass = `demand-${getDemandClass(data.score)}`;
        const scoreClass = getDemandClass(data.score);
        const multiplierText = data.multiplier >= 1 ? `+${Math.round((data.multiplier - 1) * 100)}%` : `${Math.round((data.multiplier - 1) * 100)}%`;
        weekdayHtml += `<tr><td>${day.substring(0, 3)}</td><td class="${demandClass}">${getDemandLabel(data.score)}</td>
          <td><span class="score-badge ${scoreClass}">${data.score}/15</span></td><td>${multiplierText}</td></tr>`;
      });
      weekdayTbody.innerHTML = weekdayHtml;

      // Month grid
      const monthGrid = document.getElementById('monthGrid');
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      let monthHtml = '';
      monthNames.forEach(month => {
        const monthData = months[month];
        const demandClass = getDemandClass(monthData.score);
        monthHtml += `<div class="month-item ${demandClass}" title="${monthData.reasoning}">
          <div class="month-label">${month}</div><div class="month-score">${monthData.score}/15</div></div>`;
      });
      monthGrid.innerHTML = monthHtml;

      // Special dates - SPLIT INTO TWO COLUMNS
      const longWeekendsList = document.getElementById('longWeekendsList');
      const specialEventsList = document.getElementById('specialEventsList');
      let longWeekendsHtml = '';
      let eventsHtml = '';

      specialDates.forEach(date => {
        const startDate = new Date(date.start);
        const endDate = new Date(date.end);
        const dateRange = startDate.toDateString() === endDate.toDateString()
          ? startDate.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })
          : `${startDate.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })} - ${endDate.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}`;

        const multiplierText = `+${Math.round((date.multiplier - 1) * 100)}%`;
        const itemClass = date.isLongWeekend ? 'long-weekend' : '';
        const weekendBadge = date.isLongWeekend ? `<span class="weekend-badge">${date.duration}D</span>` : '';

        const html = `
          <div class="date-item ${itemClass}">
            <div class="date-info">
              <div class="date-name">${date.name}${weekendBadge}</div>
              <div class="date-range">${dateRange}</div>
              ${date.strategy ? `<div class="date-strategy">${date.strategy}</div>` : ''}
            </div>
            <div class="date-multiplier"><span class="score-badge high">${multiplierText}</span></div>
          </div>
        `;

        if (date.isLongWeekend) {
          longWeekendsHtml += html;
        } else {
          eventsHtml += html;
        }
      });

      longWeekendsList.innerHTML = longWeekendsHtml || '<p style="color:#888; text-align:center; padding:2rem;">No long weekends found</p>';
      specialEventsList.innerHTML = eventsHtml || '<p style="color:#888; text-align:center; padding:2rem;">No special events found</p>';
      document.getElementById('datesCount').textContent = `${specialDates.length} Events`;

      // Export JSON
      document.getElementById('configJson').textContent = JSON.stringify({
        propertyConfiguration: {
          location: demandData.location,
          hotelType: demandData.hotelType,
          hotelTypeName: demandData.hotelTypeName,
          patternType: demandData.patternType
        },
        demandFactors: {
          weekdayMultipliers: Object.fromEntries(Object.entries(demandData.weekdays).map(([day, data]) => [day, { score: data.score, multiplier: data.multiplier, demand: data.demand }])),
          monthlySeasons: Object.fromEntries(Object.entries(demandData.months).map(([month, data]) => [month, { score: data.score, demand: data.demand, reasoning: data.reasoning }])),
          specialDates: demandData.specialDates.map(d => ({ name: d.name, startDate: d.start, endDate: d.end, multiplier: d.multiplier, isLongWeekend: d.isLongWeekend || false, duration: d.duration || null, strategy: d.strategy || null }))
        },
        scoringGuide: { '1-3': 'Very Low Demand (30-50% discount)', '4-6': 'Low Demand (15-25% discount)', '7-9': 'Normal Demand (Base rates)', '10-12': 'High Demand (10-20% premium)', '13-15': 'Peak Demand (30-50% premium)' },
        metadata: { generatedAt: new Date().toISOString(), version: '2.0', dataSource: 'Enhanced RMS Setup Tool' }
      }, null, 2);
    }

    function toggleExport() {
      document.getElementById('configJson').classList.toggle('show');
    }
  </script>
</body>
</html>